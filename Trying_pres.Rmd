---
title: "Untitled"
author: "Lambert Ngenzi"
date: "4/10/2022"
output: powerpoint_presentation
---
title: "Precipitation Change in Beaufort, NC"
author: "Karen Thornton, Lambert Ngenzi, Taro Katayama"
output:
  html_document:
    df_print: paged
  pdf_document:
    keep_tex: yes
    fig_caption: yes
    number_sections: yes
subtitle: Web address for GitHub repository
geometry: margin=2.54cm
fontsize: 12pt
mainfont: Times New Roman
editor_options:
  chunk_output_type: console
---

\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage


Initial steps
* get data
* Wrangle data
* graph data to see what we're working with
* try a seasonal Mann-kendall test
* divide decades and see if there's a statistical significant difference 
* Optional: map of three schools in NC
* Make presentation


```{r setup, include=FALSE}

# Set your working directory
getwd()
# Load your packages
library(tidyverse)
library(dplyr)
library(lubridate)
library(mapview)
library(sf)
library(knitr)
library(Kendall)
library(zoo)
library(gridExtra)
options(scipen = 4) # limit number of digits 

# Load your datasets
Beaufort_RAW<-read.csv("./Data/Beaufort_precip_1980-present_HUC_030203010503_dayMet_split-dates-columns.csv", stringsAsFactors = TRUE)
view(Beaufort_RAW)

# Rename columns to logical names

names(Beaufort_RAW)[1] <- "Date"
names(Beaufort_RAW)[2] <- "Mean_Precip_mm"

#Set Date as a Date
Beaufort_RAW$Date<-as.Date(Beaufort_RAW$Date, "%Y-%m-%d") 

# Set your ggplot theme
Theme <- theme_classic(base_size = 7) +
  theme(axis.text = element_text(color = "black"),
        legend.position = "right")
theme_set(Theme)

#visualize raw data
ggplot(Beaufort_RAW, aes(x= Date, y= Mean_Precip_mm))+
  geom_point()+
  geom_smooth()+
  labs(y= "Mean Precipitation (mm)", x= "Date")
```

```{r Map of Beaufort}
#Create a beaufort point using long and lat 

Beaufort_pt <-  st_point(c(-76.6515, 34.7192))

#Convert the the 2 points into a spatial
Beaufort_Pol <- st_sfc(Beaufort_pt, crs = 4326)

mapview(Beaufort_Pol)

Beaufort_Town <- st_as_sf(Beaufort_Pol)

mapview(Beaufort_Town, col.regions = "red")

# Load NC counties info 
NC_data <- st_read("./Data/Spatial/cb_2018_us_county_20m.shp") %>% 
  filter(STATEFP == 37)

# Visualize MC data
mapview(NC_data)

# Filter Beaufort county and map it 
Beaufort_County <- NC_data %>% 
  filter(NAME %in% "Carteret")

mapview(Beaufort_County, col.regions = "orange")

# Combine all map 
mapview(NC_data, alpha.regions = 0.2) +
  mapview(Beaufort_County, col.regions = "orange") +
  mapview(Beaufort_Town, col.regions = "red")
```

Wrangle Data
```{r clean}
#Created monthly mean precipitation + total monthly precipitation dataset for Beaufort. This dataset only for visualization purposes
Beaufort_Clean<- Beaufort_RAW%>%
  group_by(year,month)%>%
   summarise(meanmonthlyprecip= mean(Mean_Precip_mm),
             sumMonthlyPrecip= sum(Mean_Precip_mm))%>%
  mutate(Date= my(paste0(month,"-", year)))
```

```{r early}
#10 year time frame, precipitation in inches (1997-01-01 to 2006-12-31) +significant 24hr precipitation events in magnitude+ # of significant precipitation events
Beaufort_early<- Beaufort_RAW%>%
  mutate(PrecipInches= Mean_Precip_mm*0.0394)%>%
  filter(Date >("1996-12-31"), Date < ("2007-01-01")) %>% 
  mutate(sigPrecip= ifelse(PrecipInches>3.66,PrecipInches,0),
         NumSigPrecip= ifelse(PrecipInches>3.66, 1,0))%>%
  select(Date , year, month, 
         day_of_month, PrecipInches, sigPrecip, NumSigPrecip)%>%
  drop_na()
  
#Created Beaufort early dataset, where non significant precipitation events were classified as NA.
Beaufort_earlyNo0Precip<-Beaufort_RAW%>%
  mutate(PrecipInches=Mean_Precip_mm*0.0394)%>%
  filter(Date >("1996-12-31"), Date < ("2007-01-01")) %>% 
  mutate(sigPrecip= ifelse(PrecipInches>3.66,PrecipInches,NA),
         NumSigPrecip= ifelse(PrecipInches>3.66, 1,0))%>%
  select(Date , year, month, 
         day_of_month, PrecipInches, sigPrecip, NumSigPrecip)%>%
  drop_na()

#Summary of number of sig events per year
Beaufort_early_summary<- Beaufort_early%>%
  group_by(year)%>%
  summarise(SigPrecipEvents= sum(NumSigPrecip))

#Created table of number of significant events per year.
EarlyTable<- kable(Beaufort_early_summary, caption = "Significant Events Over Year")
EarlyTable

#Created figure with # and magnitude of significant events per year.
Plot_early_sig <- ggplot(Beaufort_earlyNo0Precip, aes(x=Date , y=sigPrecip))+
  geom_point()+
  labs(y="1-year storm events", x= "Date")
Plot_early_sig

Plot_early_overall <- ggplot(Beaufort_early, aes(x=Date , y=PrecipInches))+
  geom_point()+
  labs(y="Precipitation (inches)", x= "Date")
Plot_early_overall
```

```{r late}
#10 year time frame, precipitation in inches (2007-01-01 to 2016-12-30) +significant 24hr precipitation events in magnitude + # of significant precipitation events
Beaufort_Late<- Beaufort_RAW%>%
  mutate(PrecipInches= Mean_Precip_mm*0.0394)%>%
  filter(Date > "2006-12-31")%>%
  mutate(sigPrecip= ifelse(PrecipInches>3.66,PrecipInches,0),
         NumSigPrecip= ifelse(PrecipInches>3.66, 1,0))%>%
  select(Date, year, month, 
         day_of_month, PrecipInches, sigPrecip, NumSigPrecip)%>%
  drop_na()

#Created Beaufort late dataset, where non significant precipitation events were classified as NA.
Beaufort_LateNo0Precip<- Beaufort_RAW%>%
  mutate(PrecipInches= Mean_Precip_mm*0.0394)%>%
  filter(Date > "2006-12-31")%>%
  mutate(sigPrecip= ifelse(PrecipInches>3.66,PrecipInches,NA),
         NumSigPrecip= ifelse(PrecipInches>3.66, 1,0))%>%
  select(Date, year, month, 
         day_of_month, PrecipInches, sigPrecip, NumSigPrecip)%>%
  drop_na()

#Summary of number of sig events per year (Late)
Beaufort_late_summary<- Beaufort_Late%>%
  group_by(year)%>%
  summarise(SigPrecipEvents= sum(NumSigPrecip))

#Created figure with # and magnitude of significant events per year.
Plot_late_sig <- ggplot(Beaufort_LateNo0Precip, aes(x=Date , y=sigPrecip))+
  geom_point()+
  labs(y="1-year storm events", x= "Date")
Plot_late_sig

Plot_late_overall <- ggplot(Beaufort_Late, aes(x=Date , y=PrecipInches))+
  geom_point()+
  labs(y="Precipitation (inches)", x= "Date")
Plot_late_overall

#Created table of number of significant events per year.
LateTable<- kable(Beaufort_late_summary, caption = "Significant Events Over Year")
LateTable


```

```{r combined one year storms}
grid.arrange(Plot_early_sig, Plot_late_sig, ncol=2)
```


```{r initial plots}
#plot precip over years to see general trend. Warning: Plots zoomed in to show trend more clearly, some outliers are not included.
ggplot(Beaufort_RAW, aes(x=Date, y=Mean_Precip_mm))+
  geom_line()+
  ylim(c(0,80))+
  geom_smooth(method=lm)

#plot total monthly precip data to see rough trend
ggplot(Beaufort_Clean, aes(x=Date, y=sumMonthlyPrecip))+
  geom_line()+
  geom_smooth(method = lm) 
  
```
Analysis:
```{r t-test Overall& Seasonal Mann-Kendall Ovearall}
t.test(Beaufort_RAW$Mean_Precip_mm)
#significant

#Using Seasonal Mann-Kendall to look at trend excluding seasonality. Will be better than t-test, but we ar just running both just in case.
Beaufort_RAW_2<-Beaufort_RAW

#Used linear interpolation to fill missing data for precipitation data.
Beaufort_RAW_2$Mean_Precip_mm<-
  na.approx(Beaufort_RAW_2$Mean_Precip_mm)

#Created a time series analysis of the precipitation data at Beaufort.
firstday<- day(first(Beaufort_RAW_2$Date))
firstmonth<- month(first(Beaufort_RAW_2$Date))
firstyear<- year(first(Beaufort_RAW_2$Date))


Beaufort_TS<- ts(Beaufort_RAW_2$Mean_Precip_mm, 
                 start = c(firstyear, firstmonth, firstday),
                 frequency = 365)

#Decomposed the time series to see components.
Beaufort_decompose<- stl(Beaufort_TS, s.window = "periodic")
plot(Beaufort_decompose)

#Ran a seasonal Mann Kendall to see if there is a change in precipitation over the time of the data frame. Used seasonal Mann-Kendall to exclude seasonality of precipitation. 
Beaufort.trend<-Kendall::SeasonalMannKendall(Beaufort_TS)
Beaufort.trend
#Significant!
```

```{r t-test for decades}
#Here we are looking to see if there is a change in precipitation amount comparing two decades (1999-2006) & (2007-2016)
t.test(Beaufort_early$PrecipInches, Beaufort_Late$PrecipInches)
#not significant<- meaning precipitation amount not significantly different over the two decades

#Here we compared the significant precipitation events for the two decades (1999-2006) & (2007-2016).
t.test(Beaufort_early$sigPrecip, Beaufort_Late$sigPrecip)
#significant!<- There are more statistically significant 1 year precipitation events in later decade. 
```

Let's inspect the ACF and PACF plots. Notice the ACF plot has repeating positive and negative components (indicating seasonality), whereas the PACF decays over time without a clear seasonal structure.
```{r}
#acf(Late_full_ts) 
#pacf(Late_full_ts) 

#acf(Late_sig_ts)
#pacf(Late_sig_ts)

#acf(Early_full_ts)
#pacf(Early_full_ts)

#acf(Early_sig_ts)
#pacf(Early_sig_ts)


```


# Rationale and Research Questions

Hypothesis: There is a significant increase in significant storm events in Beaufort, NC


We will be looking at the trends of precipitation over time for Beaufort, NC. 

\newpage

# Dataset Information
```{r}

```

** Significant precipitation events are considered "1 year events" using NOAA. 


\newpage

# Exploratory Analysis 



\newpage

# Analysis

```{r}
#plot data to see possible trend

```


## Question 1: Is there is an increase in precipitation over time at Beaufort, NC?
* We will be using a Seasonal Kendall-Mann test to determine any trends in precipitation data. 
* We will be using Seasonal Mann-Kendall test because precipitation has seasonal trends. We want to look at the precipitation trends without the variable of seasonality. 

## Question 2: Is there an increase in precipitation by decade? 
* We will first visually compare the number of significant precipitation events for each decade, then run a t-test to determine if there is a significant difference in number of significant precipitation events comparing decades. 



\newpage

# Summary and Conclusions


\newpage

# References
<add references here if relevant, otherwise delete this section> 
