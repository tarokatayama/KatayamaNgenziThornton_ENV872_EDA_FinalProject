---
output: 
  pdf_document:
    keep_tex: yes
    fig_caption: yes
    number_sections: yes
geometry: margin=2.54cm
title: "Precipitation Change in Beaufort"
subtitle: "Web address for GitHub repository"
author: "Karen Thornton, Lambert Ngenzi, Taro Katayama"
fontsize: 12pt
mainfont: Times New Roman
editor_options: 
  chunk_output_type: console
---

\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage


Initial steps
* get data
* Wrangle data
* graph data to see what we're working with
* try a seasonal Mann-kendall test
* divide decades and see if there's a statistical significant difference 
* Optional: map of three schools in NC
* Make presentation


```{r setup, include=FALSE}

# Set your working directory
getwd()
# Load your packages
library(tidyverse)
library(dplyr)
library(lubridate)
library(mapview)
library(knitr)
options(scipen = 4) # limit number of digits 

# Load your datasets
Beaufort_RAW<-read.csv("./Data/Beaufort_precip_1980-present_HUC_030203010503_dayMet_split-dates-columns.csv", stringsAsFactors = TRUE)
view(Beaufort_RAW)

# Rename from Ã¯..Date to Date 

names(Beaufort_RAW)[1] <- "Date"

Beaufort_RAW$Date<-as.Date(Beaufort_RAW$Date, "%Y-%m-%d") 

# Set your ggplot theme
Theme <- theme_classic(base_size = 7) +
  theme(axis.text = element_text(color = "black"),
        legend.position = "right")
theme_set(Theme)
```


Wrangle Data
```{r clean}
#Created monthly mean precipitation + total monthly precipitation dataset for Beaufort.
Beaufort_Clean<- Beaufort_RAW%>%
  group_by(year,month)%>%
   summarise(meanmonthlyprecip= mean(Area.Weighted.Mean.Precipitation..mm.per.day.),
             sumMonthlyPrecip= sum(Area.Weighted.Mean.Precipitation..mm.per.day.))%>%
  mutate(Date= my(paste0(month,"-", year)))

```

```{r early}
#10 year time frame, precipitation in inches (1997-01-01 to 2006-12-31) +significant 24hr precipitation events in magnitude+ # of significant precipitation events
Beaufort_early<- Beaufort_RAW%>%
  mutate(PrecipInches= Area.Weighted.Mean.Precipitation..mm.per.day.*0.0394)%>%
  filter(Date >("1996-12-31"), Date < ("2007-01-01")) %>% 
  mutate(sigPrecip= ifelse(PrecipInches>3.66,PrecipInches,0),
         NumSigPrecip= ifelse(PrecipInches>3.66, 1,0))%>%
  select(Date , year, month, 
         day_of_month, PrecipInches, sigPrecip, NumSigPrecip)%>%
  drop_na()

#Summary of number of sig events per year
Beaufort_early_summary<- Beaufort_early%>%
  group_by(year)%>%
  summarise(SigPrecipEvents= sum(NumSigPrecip))
  
#check results 
ggplot(Beaufort_early, aes(x=Date , y=sigPrecip))+
  geom_point()

EarlyTable<- kable(Beaufort_early_summary, caption = "Significant Events Over Year")
EarlyTable

```

```{r late}
#10 year time frame, precipitation in inches (2007-01-01 to 2016-12-30) +significant 24hr precipitation events in magnitude + # of significant precipitation events
Beaufort_Late<- Beaufort_RAW%>%
  mutate(PrecipInches= Area.Weighted.Mean.Precipitation..mm.per.day.*0.0394)%>%
  filter(Date > "2006-12-31")%>%
  mutate(sigPrecip= ifelse(PrecipInches>3.66,PrecipInches,0),
         NumSigPrecip= ifelse(PrecipInches>3.66, 1,0))%>%
  select(Date, year, month, 
         day_of_month, PrecipInches, sigPrecip, NumSigPrecip)%>%
  drop_na()

#Summary of number of sig events per year (Late)
Beaufort_late_summary<- Beaufort_Late%>%
  group_by(year)%>%
  summarise(SigPrecipEvents= sum(NumSigPrecip))

#check results
ggplot(Beaufort_Late, aes(x=Date , y=sigPrecip))+
  geom_point()

LateTable<- kable(Beaufort_late_summary, caption = "Significant Events Over Year")
LateTable
```

```{r initial plots}
#plot mean monthly precip data to see rough trend
ggplot(Beaufort_Clean, aes(x=Date, y = meanmonthlyprecip))+
  geom_point()+
  geom_smooth(method = lm)

#plot total monthly precip data to see rough trend
ggplot(Beaufort_Clean, aes(x=Date, y=sumMonthlyPrecip))+
  geom_point()+
  geom_smooth(method = lm)
```

```{r t-test overall}
t.test(Beaufort_Clean$meanmonthlyprecip)
#significant
```

```{r t-test for decades}
t.test(Beaufort_early$PrecipInches, Beaufort_Late$PrecipInches)
#not significant

t.test(Beaufort_early$sigPrecip, Beaufort_Late$sigPrecip)
#significant!

```

```{r mann-kendall for decades}
library(Kendall)
#Note: probably won't include this because the data is seasonal data
MannKendall(Beaufort_early$PrecipInches)
MannKendall(Beaufort_early$sigPrecip)
#neither are significant

MannKendall(Beaufort_Late$PrecipInches)
#significant
MannKendall(Beaufort_Late$sigPrecip)
#not significant
```

```{r seasonal mann-kendall for decades }
Late_full_ts <- ts(Beaufort_Late$PrecipInches, start= c(1,2007), frequency = 365)
SeasonalMannKendall(Late_full_ts)
#significant

Late_sig_ts <- ts(Beaufort_Late$sigPrecip, start= c(1,2007), frequency = 365)
SeasonalMannKendall(Late_sig_ts)
#not significant

Early_full_ts <- ts(Beaufort_early$PrecipInches, start = c(1,1997), frequency = 365)
SeasonalMannKendall(Early_full_ts)
#not significant

Early_sig_ts <- ts(Beaufort_early$sigPrecip, start = c(1,1997), frequency = 365)
SeasonalMannKendall(Early_sig_ts)
#not significant 

```


Let's inspect the ACF and PACF plots. Notice the ACF plot has repeating positive and negative components (indicating seasonality), whereas the PACF decays over time without a clear seasonal structure.
```{r}

acf(Late_full_ts)  
pacf(Late_full_ts) 

acf(Late_sig_ts)
pacf(Late_sig_ts)

acf(Early_full_ts)
pacf(Early_full_ts)

acf(Early_sig_ts)
pacf(Early_sig_ts)


```


# Rationale and Research Questions

Hypothesis: There is a significant increase in significant storm events in Beaufort, NC


We will be looking at the trends of precipitation over time for Beaufort, NC. 

\newpage

# Dataset Information
```{r}

```

** Significant precipitation events are considered "1 year events" using NOAA. 


\newpage

# Exploratory Analysis 



\newpage

# Analysis

```{r}
#plot data to see possible trend
ggplot(Beaufort_RAW, aes(x=Date, y=Area.Weighted.Mean.Precipitation..mm.per.day.))+
  geom_point()+
  geom_smooth()
```


## Question 1: Is there is an increase in precipitation over time at Beaufort, NC?
* We will be using a Seasonal Kendall-Mann test to determine any trends in precipitation data. 
* We will be using Seasonal Mann-Kendall test because precipitation has seasonal trends. We want to look at the precipitation trends without the variable of seasonality. 

## Question 2: Is there an increase in precipitation by decade? 
* We will first visually compare the number of significant precipitation events for each decade, then run a t-test to determine if there is a significant difference in number of significant precipitation events comparing decades. 



\newpage

# Summary and Conclusions


\newpage

# References
<add references here if relevant, otherwise delete this section> 
